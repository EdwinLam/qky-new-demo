<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.thinkjoy.qky.classgroup.dao.biz.IBizNoticeDAO">
    <!-- 在这里存放用户自定义的映射配置（注：BizNoticeDAO.xml里各节点的ID不能在这里重复出现）  -->
    <!--获取与通知有关的用户-->
    <select id="fetchNoticeRelUser" parameterType="java.util.Map"
            resultType="cn.thinkjoy.qky.classgroup.domain.bas.BasUserEx">
		SELECT
			basUser.*,
			noticeReceive.readStatus readStatus,
			userRel.nickName groupNickName
		FROM
			bas_user
			basUser INNER JOIN biz_notice notice ON notice.STATUS = 0 and notice.id =#{id}
			INNER JOIN biz_notice_receive noticeReceive ON noticeReceive.noticeId = notice.id
			AND noticeReceive.userId = basUser.id
			AND noticeReceive.STATUS = 0
			INNER JOIN bas_group basGroup ON basGroup.id = notice.groupId
			AND basGroup.STATUS = 0
			INNER JOIN group_user_rel userRel ON userRel.groupId = basGroup.id
			AND userRel.userId = basUser.id
			AND userRel.STATUS = 0
			AND userRel.userStatus = 1
		WHERE
			basUser.STATUS = 0
	</select>

</mapper>
